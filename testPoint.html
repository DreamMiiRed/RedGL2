<html>

<head>
    <meta charset="UTF-8">
    <title>다중뷰</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, target-densitydpi=device-dpi"
    />
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
    <script src="src/gl-matrix-min.js"></script>
    <script src="src/RedGLUtil.js"></script>
    <script src="src/RedGL.js"></script>

    <script src="src/atlas/RedAtlas.js"></script>

    <script src="src/base/RedBaseContainer.js"></script>
    <script src="src/base/RedBaseLight.js"></script>
    <script src="src/base/RedBaseMaterial.js"></script>
    <script src="src/base/RedBaseObject3D.js"></script>

    <script src="src/geometry/RedBuffer.js"></script>
    <script src="src/geometry/RedGeometry.js"></script>

    <script src="src/light/RedAmbientLight.js"></script>
    <script src="src/light/RedDirectionalLight.js"></script>
    <script src="src/light/RedPointLight.js"></script>

    <script src="src/loader/JsonModelLoader.js"></script>

    <script src="src/material/RedMaterial.js"></script>
    <script src="src/material/RedColorMaterial.js"></script>
    <script src="src/material/RedColorPhongMaterial.js"></script>
    <script src="src/material/RedEnvironmentMaterial.js"></script>
    <script src="src/material/RedGridMaterial.js"></script>
    <script src="src/material/RedBitmapMaterial.js"></script>

    <script src="src/material/RedPointBitmapMaterial.js"></script>
    <script src="src/material/RedPointColorMaterial.js"></script>
    <script src="src/material/RedSkyBoxMaterial.js"></script>
    <script src="src/material/RedStandardMaterial.js"></script>

    <script src="src/object3D/RedAxis.js"></script>
    <script src="src/object3D/RedGrid.js"></script>
    <script src="src/object3D/RedMesh.js"></script>
    <script src="src/object3D/RedLine.js"></script>
    <script src="src/object3D/RedSkyBox.js"></script>
    <script src="src/object3D/RedSprite3D.js"></script>


    <script src="src/particle/RedPointUnit.js"></script>

    <script src="src/primitives/RedBox.js"></script>
    <script src="src/primitives/RedPlane.js"></script>
    <script src="src/primitives/RedSphere.js"></script>

    <script src="src/program/RedProgram.js"></script>
    <script src="src/program/RedSystemShaderCode.js"></script>
    <script src="src/program/RedShader.js"></script>

    <script src="src/renderer/RedRenderer.js"></script>
    <script src="src/renderer/RedRenderDebuger.js"></script>

    
    <script src="src/resources/RedAtlasUV.js"></script>
    <script src="src/resources/RedBitmapTexture.js"></script>
    <script src="src/resources/RedAtlasTexture.js"></script>
    <script src="src/resources/RedBitmapCubeTexture.js"></script>

    <script src="src/RedView.js"></script>
    <script src="src/RedWorld.js"></script>
    <script src="src/RedScene.js"></script>
    <script src="src/camera/RedCamera.js"></script>
</head>

<body>
    <canvas id="test" style="border: none;background:red"></canvas>
    <script>
        var t = document.getElementById('test')
        document.body.appendChild(t)
        RedGL(t, function (v) {
            var tGL;
            var tWorld, tScene3D, tCamera
            var tRenderer;
            var self;
            self = this
            tGL = this.gl;
            this.world = tWorld = RedWorld();
            tScene3D = RedScene('#223344');
            tScene3D.alpha = 0.1

            tCamera = RedCamera()
            tCamera.y = 10
            tCamera.z = 10
            tCamera.lookAt(0, 0, 0)

            tRenderer = RedRenderer();
            tWorld.addView(RedView('test', tScene3D, tCamera));


            (function () {
                var testMaterial

                testMaterial = RedPointBitmapMaterial(self, RedBitmapTexture(self, 'asset/particle.png'))
                

                var interleaveData
                interleaveData = []

                var i = 10000
                while (i--) {
                    var t = Math.random() * 100 - 50
                    interleaveData.push(Math.random() * 100 - 50, Math.random() * 100 - 50, Math.random() * 100 - 50)
                    interleaveData.push(Math.random() * 100)
                    interleaveData.push(Math.random(), Math.random(), Math.random(), 1)
                }
                interleaveData = new Float32Array(interleaveData)
              
                var testParticle = RedPointUnit(
                    self,
                    interleaveData,
                    [
                        {
                            attributeKey: 'aVertexPosition',
                            size: 3,
                            normalize: false
                        },
                        {
                            attributeKey: 'aPointSize',
                            size: 1,
                            normalize: false
                        },
                        {
                            attributeKey: 'aVertexColor',
                            size: 4,
                            normalize: false
                        }
                        // TODO: 텍스쳐를 받으려면 쿼드로 그려야하는건가..
                        // TODO: 쿼드가 아니라면 포인트에서 텍스쳐를 받아들일 방법을 고안해야함
                    ],
                    testMaterial
                )
                testParticle['useDepthTest'] = false
                // testParticle['depthTestFunc'] = self.gl.LESS
                testParticle['blendSrc'] = self.gl.SRC_ALPHA
                testParticle['blendDst'] = self.gl.ONE
                tScene3D.addChildAt(testParticle,0)
            })();
            (function () {
                var testMaterial
                testMaterial = RedPointColorMaterial(self)

                var interleaveData, interleaveData2
                interleaveData = []

                var i = 100000
                while (i--) {
                    var t = Math.random() * 100 - 50
                    interleaveData.push(Math.random() * 100 - 50, Math.random() * 100 - 50, Math.random() * 100 - 50)
                    interleaveData.push(Math.random() * 10)
                    interleaveData.push(Math.random(), Math.random(), Math.random(), 1)
                }
                interleaveData = new Float32Array(interleaveData)
                var testParticle = RedPointUnit(
                    self,
                    interleaveData,
                    [
                        {
                            attributeKey: 'aVertexPosition',
                            size: 3,
                            normalize: false
                        },
                        {
                            attributeKey: 'aPointSize',
                            size: 1,
                            normalize: false
                        },
                        {
                            attributeKey: 'aVertexColor',
                            size: 4,
                            normalize: false
                        }
                        // TODO: 텍스쳐를 받으려면 쿼드로 그려야하는건가..
                        // TODO: 쿼드가 아니라면 포인트에서 텍스쳐를 받아들일 방법을 고안해야함
                    ],
                    testMaterial
                )
                tScene3D.addChild(testParticle)
            })();

            (function () {
                var testMaterial

                testMaterial = RedPointBitmapMaterial(self, RedBitmapTexture(self, 'asset/alphaTest.png'))
                

                var interleaveData
                interleaveData = []

                var i = 10000
                while (i--) {
                    var t = Math.random() * 100 - 50
                    interleaveData.push(Math.random() * 100 - 50, Math.random() * 100 - 50, Math.random() * 100 - 50)
                    interleaveData.push(Math.random() * 100)
                    interleaveData.push(Math.random(), Math.random(), Math.random(), 1)
                }
                interleaveData = new Float32Array(interleaveData)
              
                var testParticle = RedPointUnit(
                    self,
                    interleaveData,
                    [
                        {
                            attributeKey: 'aVertexPosition',
                            size: 3,
                            normalize: false
                        },
                        {
                            attributeKey: 'aPointSize',
                            size: 1,
                            normalize: false
                        },
                        {
                            attributeKey: 'aVertexColor',
                            size: 4,
                            normalize: false
                        }
                        // TODO: 텍스쳐를 받으려면 쿼드로 그려야하는건가..
                        // TODO: 쿼드가 아니라면 포인트에서 텍스쳐를 받아들일 방법을 고안해야함
                    ],
                    testMaterial
                )
                tScene3D.addChild(testParticle)
            })();


            tScene3D['grid'] = RedGrid(self)



            tRenderer.start(this, function (time) {

                tCamera.x = Math.sin(time / 3500) * 30
                tCamera.y = Math.cos(time / 3500) * 30
                if (tCamera.y < 1) tCamera.y = 1
                tCamera.z = Math.cos(time / 3500) * 30 + Math.sin(time / 31500) * 30


                tCamera.lookAt(0, 0, 0)

                tRenderer.renderDebuger.visible = true

            })

            console.log(tScene3D)
        })
    </script>
</body>

</html>