<html>

<head>
    <meta charset="UTF-8">
    <title>기초테스트</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, target-densitydpi=device-dpi"
    />
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden
        }
    </style>
    <script src="src/gl-matrix-min.js"></script>
    <script src="src/RedGL.js"></script>
    <script src="src/base/RedBaseContainer.js"></script>
    <script src="src/base/RedBaseObject3D.js"></script>
    <script src="src/geometry/RedBuffer.js"></script>
    <script src="src/geometry/RedGeometry.js"></script>
    <script src="src/material/RedMaterial.js"></script>

    <script src="src/object3D/RedMesh.js"></script>

    <script src="src/program/RedProgram.js"></script>
    <script src="src/program/RedShader.js"></script>
    <script src="src/renderer/RedRenderer.js"></script>
    <script src="src/RedView.js"></script>
    <script src="src/RedWorld.js"></script>
    <script src="src/RedScene.js"></script>
    <script src="src/RedCamera.js"></script>
</head>

<body>
    <canvas id="test" style="border: none;background:red" width="1280" height="768"></canvas>
    <script>
        var t = document.getElementById('test')
        document.body.appendChild(t)
        RedGL(t, function (v) {
            var tGL;
            var tWorld, tScene, tCamera;
            var tRenderer;
            tGL = this.gl;
            this.world = tWorld = RedWorld();
            tScene = RedScene();
            tCamera = RedCamera();
            tRenderer = RedRenderer();
            tWorld.addView(RedView('test', tScene, tCamera));
            tWorld.addView(RedView('test2', tScene, tCamera));
            RedView('test2').setSize('25%', '25%')
            RedView('test2').setLocation(0, 0)

            var testVS, testFS;
            testVS =
                `
attribute vec3 aVertexPosition;
attribute vec4 aVertexColor;
uniform mat4 uMVMatrix;
uniform mat4 uPMatrix;
varying vec4 vColor;
void main(void) {
    vColor = aVertexColor;
    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
}
            `
            testFS =
                `
precision mediump float;
varying vec4 vColor;
void main(void) {
    gl_FragColor = vColor;
}
            `
            var testProgram = RedProgram(
                this,
                'testProgram',
                RedShader(this, 'testVS', RedShader.VERTEX, testVS),
                RedShader(this, 'testFS', RedShader.FRAGMENT, testFS)
            )
            var testMaterial = RedMaterial(testProgram)
            var positionData = new Float32Array([
                0.0, 1.0, 0.0,
                -1.0, -1.0, 0.0,
                1.0, -1.0, 0.0,
            ]);
            var colorData = new Float32Array([
                1.0, 0.0, 0.0, 1.0,
                0.0, 1.0, 0.0, 1.0,
                0.0, 0.0, 1.0, 1.0
            ]);
            var data = new Float32Array([
                0.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0,
                -1.0, -1.0, 0.0, 0.0, 1.0, 0.0, 1.0,
                1.0, -1.0, 0.0, 0.0, 0.0, 1.0, 1.0
            ]);

            var testBuffer = RedBuffer(
                this,
                'testBuffer',
                data,
                RedBuffer.ARRAY_BUFFER,
                [
                    {
                        attributeKey: 'aVertexPosition',
                        size: 3,
                        normalize: false
                    },
                    {
                        attributeKey: 'aVertexColor',
                        size: 4,
                        normalize: false
                    }
                ])
            var geometry = RedGeometry(testBuffer)


            var testMesh
            var i = 3000
            while (i--) {
                testMesh = RedMesh(geometry, testMaterial)
                tScene.addChild(testMesh)
            }


        
            tRenderer.start(this, function (time) {
             
                data[2] = Math.sin(time / 100)
                // testBuffer.updateData(data)
                i = tScene.children.length
                while (i--) {
                    testMesh = tScene.children[i]
                    // testMesh.rotationX = time/10000
                    // testMesh.rotationY = time/10000
                    testMesh.rotationZ = time/1000
                }
                RedView('test2').setLocation(Math.cos(time / 1000)*100+100, Math.sin(time / 1000)*100+100)

            })

            console.log(tScene)
        })
    </script>
</body>

</html>