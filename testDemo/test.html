<html>

<head>
    <meta charset="UTF-8">
    <title>test</title>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, target-densitydpi=device-dpi"
    />
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
    <script src="../example/dat.gui.min.js"></script>
    <script src="../src/gl-matrix-min.js"></script>
    <script src="../src/RedGLUtil.js"></script>
    <script src="../src/RedGL.js"></script>
    <script src="../src/RedXR.js"></script>
    <!--//-->
    <script src="../src/base/RedDefinePropertyInfo.js"></script>
    <!--//-->
    <script src="../src/frameBuffer/RedFrameBuffer.js"></script>
    <!--//-->
    <script src="../src/geometry/RedBuffer.js"></script>
    <script src="../src/geometry/RedGeometry.js"></script>
    <script src="../src/geometry/RedInterleaveInfo.js"></script>
    <!--//-->

    <!--//-->
    <script src="../src/resources/RedAtlas.js"></script>
    <script src="../src/resources/system/RedAtlasUV.js"></script>
    <script src="../src/resources/system/RedTextureOptionChecker.js"></script>
    <script src="../src/resources/RedBitmapTexture.js"></script>
    <script src="../src/resources/RedVideoTexture.js"></script>
    <script src="../src/resources/RedAtlasTexture.js"></script>
    <script src="../src/resources/RedBitmapCubeTexture.js"></script>
    <!--재질-->
    <script src="../src/base/RedBaseMaterial.js"></script>
    <script src="../src/material/RedColorMaterial.js"></script>
    <script src="../src/material/RedColorPhongMaterial.js"></script>
    <script src="../src/material/RedColorPhongTextureMaterial.js"></script>
    <script src="../src/material/RedEnvironmentMaterial.js"></script>
    <script src="../src/material/RedBitmapMaterial.js"></script>
    <script src="../src/material/RedParticleColorMaterial.js"></script>
    <script src="../src/material/RedParticleBitmapMaterial.js"></script>
    <script src="../src/material/RedPointBitmapMaterial.js"></script>
    <script src="../src/material/RedSheetMaterial.js"></script>
    <script src="../src/material/RedStandardMaterial.js"></script>
    <script src="../src/material/RedVideoMaterial.js"></script>
    <!--//-->
    <script src="../src/base/RedBaseObject3D.js"></script>
    <script src="../src/base/RedBaseContainer.js"></script>
    <script src="../src/base/RedBaseLight.js"></script>
    <!--//-->
    <script src="../src/light/RedAmbientLight.js"></script>
    <script src="../src/light/RedDirectionalLight.js"></script>
    <script src="../src/light/RedPointLight.js"></script>
    <!--//-->
    <script src="../src/loader/JsonModelLoader.js"></script>
    <script src="../src/loader/obj/RedMTLLoader.js"></script>
    <script src="../src/loader/obj/RedOBJLoader.js"></script>
    <!--//-->
    <script src="../src/object3D/RedAxis.js"></script>
    <script src="../src/object3D/RedGrid.js"></script>
    <script src="../src/object3D/RedMesh.js"></script>
    <script src="../src/object3D/RedLine.js"></script>
    <script src="../src/object3D/RedSkyBox.js"></script>
    <script src="../src/object3D/RedSprite3D.js"></script>
    <!--//-->
    <script src="../src/particle/RedPointUnit.js"></script>
    <script src="../src/particle/RedParticleUnit.js"></script>
    <script src="../src/particle/RedParticleEmitter.js"></script>
    <!--//-->
    <script src="../src/primitives/RedBox.js"></script>
    <script src="../src/primitives/RedPlane.js"></script>
    <script src="../src/primitives/RedSphere.js"></script>
    <!--//-->
    <script src="../src/program/RedProgram.js"></script>
    <script src="../src/program/RedSystemShaderCode.js"></script>
    <script src="../src/program/RedShader.js"></script>
    <!--//-->
    <script src="../src/renderer/RedRenderer.js"></script>
    <script src="../src/renderer/system/RedRenderDebuger.js"></script>
    <!--//-->
    <script src="../src/RedView.js"></script>
    <script src="../src/RedWorld.js"></script>
    <script src="../src/RedScene.js"></script>
    <!--//-->
    <script src="../src/camera/RedCamera.js"></script>
    <script src="../src/camera/RedBasicController.js"></script>
    <script src="../src/camera/RedObitController.js"></script>
    <!--시스템 재질-->
    <script src="../src/material/system/RedGridMaterial.js"></script>
    <script src="../src/material/RedPointColorMaterial.js"></script>
    <script src="../src/material/system/RedSkyBoxMaterial.js"></script>
    <script src="../src/material/system/RedPostEffectMaterial.js"></script>
    <!--이펙트-->
    <script src="../src/postEffect/RedPostEffectManager.js"></script>
    <script src="../src/postEffect/RedPostEffect_Bloom.js"></script>
    <script src="../src/postEffect/RedPostEffect_BloomThreshold.js"></script>
    <script src="../src/postEffect/blur/RedPostEffect_Blur.js"></script>
    <script src="../src/postEffect/blur/RedPostEffect_BlurX.js"></script>
    <script src="../src/postEffect/blur/RedPostEffect_BlurY.js"></script>
    <script src="../src/postEffect/blur/RedPostEffect_GaussianBlur.js"></script>
    <script src="../src/postEffect/blur/RedPostEffect_ZoomBlur.js"></script>
    <script src="../src/postEffect/adjustments/RedPostEffect_BrightnessContrast.js"></script>
    <script src="../src/postEffect/adjustments/RedPostEffect_Threshold.js"></script>
    <script src="../src/postEffect/adjustments/RedPostEffect_Invert.js"></script>
    <script src="../src/postEffect/adjustments/RedPostEffect_Gray.js"></script>
    <script src="../src/postEffect/adjustments/RedPostEffect_HueSaturation.js"></script>
    <script src="../src/postEffect/pixelate/RedPostEffect_HalfTone.js"></script>
    <script src="../src/postEffect/pixelate/RedPostEffect_Pixelize.js"></script>
    <script src="../src/postEffect/RedPostEffect_Convolution.js"></script>
    <script src="../src/postEffect/RedPostEffect_DoF.js"></script>
    <script src="../src/postEffect/RedPostEffect_DoF_DepthMaterial.js"></script>
    <script src="../src/postEffect/RedPostEffect_Film.js"></script>
    <script src="../src/postEffect/RedPostEffect_Vignetting.js"></script>
    <script src="../src/postEffect/antialiasing/RedPostEffect_FXAA.js"></script>
</head>

<body>
<canvas id="test" style="border: none;background:red"></canvas>
<script>
	var t = document.getElementById('test')
	document.body.appendChild(t)
	RedGL(t, function (v) {
		var tGL;
		var tWorld, tScene3D, tCamera
		var tRenderer;
		var self;
		self = this
		tGL = this.gl;
		this.world = tWorld = RedWorld();
		tScene3D = RedScene(this);
//		tScene3D['postEffectManager'].addEffect(RedPostEffect_Invert(this))
		// tScene3D['postEffectManager'].addEffect(RedPostEffect_Blur(this))
//		tScene3D['postEffectManager'].addEffect(RedPostEffect_Gray(this))
		// tScene3D['postEffectManager'].addEffect(RedPostEffect_Pixelize(this))
		// tScene3D['postEffectManager'].addEffect(RedPostEffect_Convolution(this,RedPostEffect_Convolution['EMBOSS']))
		// tScene3D['postEffectManager'].addEffect(RedPostEffect_HueSaturation(this))
//		tScene3D['postEffectManager'].addEffect(RedPostEffect_Vignetting(this))
		// tScene3D['postEffectManager'].addEffect(RedPostEffect_BrightnessContrast(this))
		var zoomBlur = RedPostEffect_ZoomBlur(this)
		tScene3D['postEffectManager'].addEffect(zoomBlur)
		// tScene3D['postEffectManager'].addEffect(RedPostEffect_HalfTone(this))
//		tScene3D['postEffectManager'].addEffect( RedPostEffect_Bloom( this ) )
		tCamera = RedCamera();
		var testDLight, testALight;
		testDLight = RedDirectionalLight(this, '#fff')
		testALight = RedAmbientLight(this, '#111', 1)
		tScene3D.addLight(testALight)
		tScene3D.addLight(testDLight)
		var testPLight = RedPointLight(this, '#ff0000')
		testPLight.x = -3
		testPLight.y = -3
		testPLight.z = -3
		testPLight['radius'] = 4
		testPLight['intensity'] = 1
		testPLight.debug = true
		tScene3D.addLight(testPLight)
		var testPLight2 = RedPointLight(this, '#00ff00')
		testPLight2.x = -3
		testPLight2.y = -3
		testPLight2.z = -3
		testPLight2['radius'] = 6
		testPLight2['intensity'] = 1
		testPLight2.debug = true
		tScene3D.addLight(testPLight2)
		tRenderer = RedRenderer();
		tWorld.addView(RedView('test', tScene3D, tCamera));
		RedView('test').setSize('100%', '100%')
		RedView('test').setLocation('0%', '0%')
		var testMaterial
		testMaterial = RedEnvironmentMaterial(
			this,
			RedBitmapTexture(this, '../asset/crate.png'),
			RedBitmapCubeTexture(this, [
				'../asset/cubemap/posx.png',
				'../asset/cubemap/negx.png',
				'../asset/cubemap/posy.png',
				'../asset/cubemap/negy.png',
				'../asset/cubemap/posz.png',
				'../asset/cubemap/negz.png'
			])
			, RedBitmapTexture(this, '../asset/normalTest.jpg')
			, RedBitmapTexture(this, '../asset/specular.png')
			, RedBitmapTexture(this, '../asset/displacementTest.jpg')
		)
		tScene3D.skyBox =
			RedSkyBox(this, [
				'../asset/cubemap/posx.png',
				'../asset/cubemap/negx.png',
				'../asset/cubemap/posy.png',
				'../asset/cubemap/negy.png',
				'../asset/cubemap/posz.png',
				'../asset/cubemap/negz.png'
			]);
		(function () {
			var testMaterial
			testMaterial = RedPointColorMaterial(self)
			var interleaveData, interleaveData2
			interleaveData = []
			var i = 100000
			while ( i-- ) {
				var t = Math.random() * 100 - 50
				interleaveData.push(Math.random() * 100 - 50, Math.random() * 100 - 50, Math.random() * 100 - 50)
				interleaveData.push(Math.random() * 5)
				interleaveData.push(Math.random(), Math.random(), Math.random(), 1)
			}
			interleaveData = new Float32Array(interleaveData)
			var testParticle = RedPointUnit(
				self,
				interleaveData,
				[
					RedInterleaveInfo('aVertexPosition', 3),
					RedInterleaveInfo('aPointSize', 1),
					RedInterleaveInfo('aVertexColor', 4)
				],
				testMaterial
			)
			tScene3D.addChild(testParticle)
		})();
		(function () {
			var testMaterial
			testMaterial = RedPointBitmapMaterial(self, RedBitmapTexture(self, '../asset/alphaTest.png'))
			var interleaveData
			interleaveData = []
			var i = 100000
			while ( i-- ) {
				interleaveData.push(Math.random() * 150 - 75, Math.random() * 150 - 75, Math.random() * 150 - 75)
				interleaveData.push(Math.random() * 50)
				interleaveData.push(Math.random(), Math.random(), Math.random(), 1)
			}
			interleaveData = new Float32Array(interleaveData)
			var testParticle = RedPointUnit(
				self,
				interleaveData,
				[
					RedInterleaveInfo('aVertexPosition', 3),
					RedInterleaveInfo('aPointSize', 1),
					RedInterleaveInfo('aVertexColor', 4)
				],
				testMaterial
			)
			tScene3D.addChild(testParticle)
		})();
		JsonModelLoader(this, 'testJsonModel', '../asset/teapot.json', function (interleaveBuffer, indexBuffer) {
			console.log('호잇!', interleaveBuffer, indexBuffer)
			var i = 5000
			while ( i-- ) {
				var testMesh = RedMesh(self, RedGeometry(interleaveBuffer, indexBuffer), testMaterial)
				testMesh.x = Math.random() * 250 - 125
				testMesh.y = Math.random() * 250 - 125
				testMesh.z = Math.random() * 250 - 125
				testMesh.scaleX = testMesh.scaleY = testMesh.scaleZ = 0.3
				testMesh.rotationX = Math.random() * 360
				testMesh.rotationY = Math.random() * 360
				testMesh.rotationZ = Math.random() * 360
				tScene3D.addChild(testMesh)
			}
			var testMesh = RedMesh(self, RedGeometry(interleaveBuffer, indexBuffer), testMaterial)
			testMesh.scaleX = testMesh.scaleY = testMesh.scaleZ = 0.1
			tScene3D.addChild(testMesh)
			var i = 10
			while ( i-- ) {
				var testMesh2 = RedSprite3D(self, RedColorMaterial(self))
				testMesh2.x = Math.sin(Math.PI * 2 / 10 * i) * 5
				testMesh2.y = Math.cos(Math.PI * 2 / 10 * i) * 5
				// testMesh2.scaleX = testMesh2.scaleY = testMesh2.scaleZ =10
				tScene3D.addChild(testMesh2)
			}
			tScene3D['grid'] = RedGrid(self)
			i = 100
			while ( i-- ) {
				var testLine = new RedLine(self, new RedColorMaterial(self, i % 2 ? '#ff0000' : i % 3 ? '#00ff00' : '#0000ff', Math.random()))
				console.log(testLine.material)
				// var testLine = new RedLine(this, testMaterial2)
				var tX, tY, tZ
				var i2 = 4
				tX = tY = tZ = 0
				// testLine.addPoint(0, 0, 0)
				// testLine.addPoint(100, 0, 0)
				// testLine.addPoint(200, 0, 0)
				// testLine.addPoint(300, 0, 0)
				// testLine.addPoint(300, 0, 0)
				// testLine.addPoint(300, 100, 0)
				// testLine.addPoint(300, 100+Math.random()*50, 0)
				// testLine.addPoint(600, 100+Math.random()*50, 0)
				var i2 = 3 * 10
				tX = tY = tZ = 0
				while ( i2-- ) {
					tX += Math.random()
					tY += Math.random()
					tZ += Math.random()
					testLine.addPoint(tX, tY, tZ)
				}
				testLine.rotationX = Math.random() * 360
				testLine.rotationY = Math.random() * 360
				testLine.rotationZ = Math.random() * 360
				testLine.upload()
				tScene3D.addChild(testLine)
			}
		})
		tRenderer.renderDebuger.visible = true
		tRenderer.start(this, function (time) {
			// testInterleaveBuffer.upload(interleaveData)
			var i = tScene3D.children.length
			while ( i-- ) {
				if ( i == 0 ) break
				testMesh = tScene3D.children[i]
				testMesh.rotationX += 0.1
				testMesh.rotationY += 0.1
				testMesh.rotationZ += 0.1
			}
			testDLight.x = Math.sin(time / 1500) * 10
			testDLight.y = Math.cos(time / 1500) * 10
			testDLight.z = Math.cos(time / 1500) * 10
			testMaterial['displacementPower'] = Math.sin(time / 100)
			tCamera.x = Math.sin(time / 3500) * 20
			tCamera.y = Math.cos(time / 3500) * 20
			tCamera.z = Math.cos(time / 3500) * 20
			// tCamera.z = 20
			// tCamera.lookAt(0, 0, 0)
			testPLight.x = -Math.sin(time / 1500) * 5
			testPLight.y = 2
			testPLight.z = -Math.cos(time / 1500) * 5
			testPLight2.x = Math.sin(time / 1500) * 18.5
			testPLight2.y = 0
			testPLight2.z = Math.cos(time / 1500) * 18.5
//			zoomBlur.centerX = Math.sin(time / 1000) / 3.14
//			zoomBlur.centerY = Math.sin(time / 1000) / 3.14
			zoomBlur.amount = Math.sin(time / 500) * 38
		})
		console.log(tScene3D)
	})
</script>
</body>

</html>