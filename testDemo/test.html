<html>

<head>
    <meta charset="UTF-8">
    <title>test</title>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, target-densitydpi=device-dpi"
    />
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
    <script src="../example/dat.gui.min.js"></script>
    <script src="../release/RedGL.min.js"></script>
</head>

<body>
<canvas id="test" style="border: none;"></canvas>
<script>
    var t = document.getElementById('test')
    document.body.appendChild(t)
    RedGL(t, function (v) {
        var tGL;
        var tWorld, tScene3D, tCamera
        var tRenderer;
        var self;
        self = this
        tGL = this.gl;
        this.world = tWorld = RedWorld();
        tScene3D = RedScene(this);
        tCamera = RedCamera();
        var testDLight, testALight;
        testDLight = RedDirectionalLight(this, '#fff')
        testALight = RedAmbientLight(this, '#111', 1)
        tScene3D.addLight(testALight)
        tScene3D.addLight(testDLight)
        var testPLight = RedPointLight(this, '#ff0000')
        testPLight.x = -3
        testPLight.y = -3
        testPLight.z = -3
        testPLight['radius'] = 4
        testPLight['intensity'] = 1
        testPLight.debug = true
        tScene3D.addLight(testPLight)
        var testPLight2 = RedPointLight(this, '#00ff00')
        testPLight2.x = -3
        testPLight2.y = -3
        testPLight2.z = -3
        testPLight2['radius'] = 6
        testPLight2['intensity'] = 1
        testPLight2.debug = true
        tScene3D.addLight(testPLight2)
        tRenderer = RedRenderer();
        tRenderer.setDebugButton()
        tWorld.addView(RedView('test', this, tScene3D, tCamera));
        RedView('test').setSize('100%', '100%')
        RedView('test').setLocation('0%', '0%')
//		RedView('test')['postEffectManager'].addEffect(RedPostEffect_Invert(this))
//		RedView('test')['postEffectManager'].addEffect(RedPostEffect_Blur(this))
//		RedView('test')['postEffectManager'].addEffect(RedPostEffect_Gray(this))
//		RedView('test')['postEffectManager'].addEffect(RedPostEffect_Pixelize(this))
//		RedView('test')['postEffectManager'].addEffect(RedPostEffect_Convolution(this, RedPostEffect_Convolution['EMBOSS']))
//		RedView('test')['postEffectManager'].addEffect(RedPostEffect_HueSaturation(this))
//		RedView('test')['postEffectManager'].addEffect(RedPostEffect_Vignetting(this))
        var test = RedPostEffect_BrightnessContrast(this)
        RedView('test')['postEffectManager'].addEffect(test)
        console.log(test)
        var zoomBlur = RedPostEffect_ZoomBlur(this)
//		RedView('test')['postEffectManager'].addEffect(zoomBlur)
//		RedView('test')['postEffectManager'].addEffect(RedPostEffect_HalfTone(this))
//		RedView('test')['postEffectManager'].addEffect(RedPostEffect_Bloom(this))
        var testMaterial
        testMaterial = RedEnvironmentMaterial(
            this,
            RedBitmapTexture(this, '../asset/brick/Brick03_col.jpg'),
            RedBitmapCubeTexture(this, [
                '../asset/cubemap/SwedishRoyalCastle/px.jpg',
                '../asset/cubemap/SwedishRoyalCastle/nx.jpg',
                '../asset/cubemap/SwedishRoyalCastle/py.jpg',
                '../asset/cubemap/SwedishRoyalCastle/ny.jpg',
                '../asset/cubemap/SwedishRoyalCastle/pz.jpg',
                '../asset/cubemap/SwedishRoyalCastle/nz.jpg'
            ])
//			, RedBitmapTexture(this, '../asset/brick/Brick03_nrm.jpg')
//			, RedBitmapTexture(this, '../asset/specular.png')
//			, RedBitmapTexture(this, '../asset/displacementTest.jpg')
        )
        tScene3D.skyBox =
            RedSkyBox(this, [
                '../asset/cubemap/SwedishRoyalCastle/px.jpg',
                '../asset/cubemap/SwedishRoyalCastle/nx.jpg',
                '../asset/cubemap/SwedishRoyalCastle/py.jpg',
                '../asset/cubemap/SwedishRoyalCastle/ny.jpg',
                '../asset/cubemap/SwedishRoyalCastle/pz.jpg',
                '../asset/cubemap/SwedishRoyalCastle/nz.jpg'
            ]);
        (function () {
            var testMaterial
            testMaterial = RedColorPointCloudMaterial(self)
            var interleaveData, interleaveData2
            interleaveData = []
            var i = 100000
            while (i--) {
                var t = Math.random() * 100 - 50
                interleaveData.push(Math.random() * 100 - 50, Math.random() * 100 - 50, Math.random() * 100 - 50)
                interleaveData.push(Math.random() * 0.1)
                interleaveData.push(Math.random(), Math.random(), Math.random(), 1)
            }
            var testParticle = RedColorPointCloud(
                self,
                interleaveData,
                [
                    RedInterleaveInfo('aVertexPosition', 3),
                    RedInterleaveInfo('aPointSize', 1),
                    RedInterleaveInfo('aVertexColor', 4)
                ],
                testMaterial
            )
            tScene3D.addChild(testParticle)
        })();
        (function () {
            var testMaterial
            testMaterial = RedBitmapPointCloudMaterial(self, RedBitmapTexture(self, '../asset/alphaTest.png'))
            var interleaveData
            interleaveData = []
            var i = 100000
            while (i--) {
                interleaveData.push(Math.random() * 150 - 75, Math.random() * 150 - 75, Math.random() * 150 - 75)
                interleaveData.push(Math.random() * 2)
                interleaveData.push(Math.random(), Math.random(), Math.random(), 1)
            }
            var testParticle = RedBitmapPointCloud(
                self,
                interleaveData,
                [
                    RedInterleaveInfo('aVertexPosition', 3),
                    RedInterleaveInfo('aPointSize', 1),
                    RedInterleaveInfo('aVertexColor', 4)
                ],
                testMaterial
            )
            tScene3D.addChild(testParticle)
        })();
        JsonModelLoader(this, 'testJsonModel', '../asset/teapot.json', function (interleaveBuffer, indexBuffer) {
            console.log('호잇!', interleaveBuffer, indexBuffer)
            var i = 6000
            while (i--) {
                var testMesh = RedMesh(self, RedGeometry(interleaveBuffer, indexBuffer), testMaterial)
                testMesh.x = Math.random() * 250 - 125
                testMesh.y = Math.random() * 250 - 125
                testMesh.z = Math.random() * 250 - 125
                testMesh.scaleX = testMesh.scaleY = testMesh.scaleZ = 0.3
                testMesh.rotationX = Math.random() * 360
                testMesh.rotationY = Math.random() * 360
                testMesh.rotationZ = Math.random() * 360
                tScene3D.addChild(testMesh)
            }
            var testMesh = RedMesh(self, RedGeometry(interleaveBuffer, indexBuffer), testMaterial)
            testMesh.scaleX = testMesh.scaleY = testMesh.scaleZ = 0.3
            tScene3D.addChild(testMesh)
            var i = 10
            while (i--) {
                var testMesh2 = RedSprite3D(self, RedColorMaterial(self))
                testMesh2.x = Math.sin(Math.PI * 2 / 10 * i) * 5
                testMesh2.y = Math.cos(Math.PI * 2 / 10 * i) * 5
                // testMesh2.scaleX = testMesh2.scaleY = testMesh2.scaleZ =10
                tScene3D.addChild(testMesh2)
            }
            tScene3D['grid'] = RedGrid(self)
            i = 250
            while (i--) {
                var testLine = new RedLine(self, new RedColorMaterial(self, i % 2 ? '#ff0000' : i % 3 ? '#00ff00' : '#0000ff', Math.random()))
                console.log(testLine.material)
                // var testLine = new RedLine(this, testMaterial2)
                var tX, tY, tZ
                var i2 = 4
                tX = tY = tZ = 0
                // testLine.addPoint(0, 0, 0)
                // testLine.addPoint(100, 0, 0)
                // testLine.addPoint(200, 0, 0)
                // testLine.addPoint(300, 0, 0)
                // testLine.addPoint(300, 0, 0)
                // testLine.addPoint(300, 100, 0)
                // testLine.addPoint(300, 100+Math.random()*50, 0)
                // testLine.addPoint(600, 100+Math.random()*50, 0)
                var i2 = 3 * 10
                tX = tY = tZ = 0
                while (i2--) {
                    tX += Math.random()
                    tY += Math.random()
                    tZ += Math.random()
                    testLine.addPoint(tX, tY, tZ)
                }
                testLine.rotationX = Math.random() * 360
                testLine.rotationY = Math.random() * 360
                testLine.rotationZ = Math.random() * 360
                tScene3D.addChild(testLine)
            }
        })

        tScene3D.sortGeometry()
        tRenderer.start(this, function (time) {
            // testInterleaveBuffer.upload(interleaveData)
            var i = tScene3D.children.length
            while (i--) {
                if (i == 0) break
                testMesh = tScene3D.children[i]
                testMesh.rotationX += 0.1
                testMesh.rotationY += 0.1
                testMesh.rotationZ += 0.1
            }
            testDLight.x = Math.sin(time / 1500) * 10
            testDLight.y = Math.cos(time / 1500) * 10
            testDLight.z = Math.cos(time / 1500) * 10
            testMaterial['displacementPower'] = Math.sin(time / 100)
            tCamera.x = Math.sin(time / 3500) * 20
            tCamera.y = Math.cos(time / 3500) * 20
            tCamera.z = Math.cos(time / 3500) * 20
            // tCamera.z = 20
            // tCamera.lookAt(0, 0, 0)
            testPLight.x = -Math.sin(time / 1500) * 5
            testPLight.y = 2
            testPLight.z = -Math.cos(time / 1500) * 5
            testPLight2.x = Math.sin(time / 1500) * 18.5
            testPLight2.y = 0
            testPLight2.z = Math.cos(time / 1500) * 18.5
//			zoomBlur.centerX = Math.sin(time / 1000) / 3.14
//			zoomBlur.centerY = Math.sin(time / 1000) / 3.14
            zoomBlur.amount = Math.sin(time / 500) * 38
        })
        console.log(tScene3D)
    })
</script>
</body>

</html>