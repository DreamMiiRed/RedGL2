<html>

<head>
    <meta charset="UTF-8">
    <title>draftSSAO</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, target-densitydpi=device-dpi"
    />
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
    <script src="../example/dat.gui.min.js"></script>
    <script src="../src/gl-matrix-min.js"></script>
    <script src="../src/RedGLUtil.js"></script>
    <script src="../src/RedGL.js"></script>

    <script src="../src/base/RedBaseContainer.js"></script>
    <script src="../src/base/RedBaseLight.js"></script>
    <script src="../src/base/RedBaseMaterial.js"></script>
    <script src="../src/base/RedBaseObject3D.js"></script>

    <script src="../src/geometry/RedBuffer.js"></script>
    <script src="../src/geometry/RedGeometry.js"></script>
    <script src="../src/geometry/RedInterleaveInfo.js"></script>

    <script src="../src/frameBuffer/RedFrameBuffer.js"></script>

    <script src="../src/light/RedAmbientLight.js"></script>
    <script src="../src/light/RedDirectionalLight.js"></script>
    <script src="../src/light/RedPointLight.js"></script>

    <script src="../src/loader/JsonModelLoader.js"></script>
    <script src="../src/loader/RedMTLLoader.js"></script>
    <script src="../src/loader/RedOBJLoader.js"></script>

    <script src="../src/material/RedMaterial.js"></script>
    <script src="../src/material/RedColorMaterial.js"></script>
    <script src="../src/material/RedColorPhongMaterial.js"></script>
    <script src="../src/material/RedColorPhongTextureMaterial.js"></script>

    <script src="../src/material/RedEnvironmentMaterial.js"></script>
    <script src="../src/material/RedBitmapMaterial.js"></script>
    <script src="../src/material/RedPointBitmapMaterial.js"></script>
    <script src="../src/material/RedStandardMaterial.js"></script>

    <script src="../src/material/system/RedGridMaterial.js"></script>
    <script src="../src/material/RedPointColorMaterial.js"></script>
    <script src="../src/material/system/RedSkyBoxMaterial.js"></script>
    <script src="../src/material/system/RedPostEffectMaterial.js"></script>
    

    <script src="../src/object3D/RedAxis.js"></script>
    <script src="../src/object3D/RedGrid.js"></script>
    <script src="../src/object3D/RedMesh.js"></script>
    <script src="../src/object3D/RedLine.js"></script>
    <script src="../src/object3D/RedSkyBox.js"></script>
    <script src="../src/object3D/RedSprite3D.js"></script>

    <script src="../src/particle/RedPointUnit.js"></script>

    <script src="../src/postEffect/RedPostEffect_Blur.js"></script>
    <script src="../src/postEffect/RedPostEffect_BlurX.js"></script>
    <script src="../src/postEffect/RedPostEffect_BlurY.js"></script>
    <script src="../src/postEffect/RedPostEffect_Bloom.js"></script>
    <script src="../src/postEffect/RedPostEffect_BloomThreshold.js"></script>
    <script src="../src/postEffect/RedPostEffect_Convolution.js"></script>
    <script src="../src/postEffect/RedPostEffect_DoF.js"></script>
    <script src="../src/postEffect/RedPostEffect_DoF_DepthMaterial.js"></script>
    <script src="../src/postEffect/RedPostEffect_SSAO.js"></script>
    <script src="../src/postEffect/RedPostEffect_SSAO_DepthMaterial.js"></script>
    <script src="../src/postEffect/RedPostEffect_SSAO_PointMaker.js"></script>


    <script src="../src/postEffect/RedPostEffect_Invert.js"></script>
    <script src="../src/postEffect/RedPostEffect_Gray.js"></script>
    <script src="../src/postEffect/RedPostEffect_GaussianBlur.js"></script>
    <script src="../src/postEffect/RedPostEffect_HueSaturation.js"></script>
    <script src="../src/postEffect/RedPostEffect_BrightnessContrast.js"></script>
    <script src="../src/postEffect/RedPostEffect_Vignetting.js"></script>
    <script src="../src/postEffect/RedPostEffect_Pixelize.js"></script>
    <script src="../src/postEffect/RedPostEffect_ZoomBlur.js"></script>
    <script src="../src/postEffect/RedPostEffect_HalfTone.js"></script>
    <script src="../src/postEffect/RedPostEffect_Threshold.js"></script>

    <script src="../src/postEffect/antialiasing/RedPostEffect_FXAA.js"></script>


    <script src="../src/postEffect/RedPostEffectManager.js"></script>

    <script src="../src/primitives/RedBox.js"></script>
    <script src="../src/primitives/RedPlane.js"></script>
    <script src="../src/primitives/RedSphere.js"></script>

    <script src="../src/program/RedProgram.js"></script>
    <script src="../src/program/RedSystemShaderCode.js"></script>
    <script src="../src/program/RedShader.js"></script>

    <script src="../src/renderer/RedRenderer.js"></script>


    <script src="../src/renderer/system/RedRenderDebuger.js"></script>

    <script src="../src/resources/RedAtlas.js"></script>
    <script src="../src/resources/system/RedAtlasUV.js"></script>
    <script src="../src/resources/RedBitmapTexture.js"></script>
    <script src="../src/resources/RedAtlasTexture.js"></script>
    <script src="../src/resources/RedBitmapCubeTexture.js"></script>

    <script src="../src/RedView.js"></script>
    <script src="../src/RedWorld.js"></script>
    <script src="../src/RedScene.js"></script>
    <script src="../src/camera/RedCamera.js"></script>
    <script src="../src/camera/RedBasicController.js"></script>
    <script src="../src/camera/RedObitController.js"></script>

</head>

<body>
    <canvas id="test" style="border: none;background:red"></canvas>
    <script>
        document.getElementById('test')
        RedGL(document.getElementById('test'), function (v) {

            console.log(v)
            var tGL;
            var tWorld, tScene3D, tCamera
            var tRenderer;
            var self;
            self = this
            tGL = this.gl;
            this.world = tWorld = RedWorld();
            tScene3D = RedScene(this);

            // tScene3D['useFog'] = true

            tCamera = RedObitController(this);
            tCamera.tilt = -45
            tCamera.distance = 40
            tRenderer = RedRenderer();
            tWorld.addView(RedView('test', tScene3D, tCamera));
            RedView('test').setSize('100%', '100%')
            RedView('test').setLocation('0%', '0%')
            this.renderScale = 1

            var testDLight, testALight, testPLight;
            testDLight = RedDirectionalLight(this)
            testDLight.x = 3
            testDLight.y = 2
            testDLight.z = 3
            testDLight.debug = true
            testDLight.intensity = 1.5
            tScene3D.addLight(testDLight)


       

            // var ssao = RedPostEffect_SSAO_PointMaker(this)
            var ssao = RedPostEffect_SSAO(this)

            tScene3D['postEffectManager'].addEffect(ssao)

            // var bloom = RedPostEffect_Bloom(this)
            // tScene3D['postEffectManager'].addEffect(bloom)


            tScene3D.skyBox =
                RedSkyBox(this, [
                    '../asset/cubemap/posx.png',
                    '../asset/cubemap/negx.png',
                    '../asset/cubemap/posy.png',
                    '../asset/cubemap/negy.png',
                    '../asset/cubemap/posz.png',
                    '../asset/cubemap/negz.png'
                ]);

            // tScene3D['grid'] = RedGrid(self)
            var i = 1000

            var j
            var k
            var tMesh;

            // var tGeo = RedSphere(self, 0.5,  16, 16, 16)
            var tMat = RedColorMaterial(
                self
            )
            var tMat2 = RedBitmapMaterial(
                self,
                RedBitmapTexture(self, '../asset/crate.png')
            )

            var tMat3 = RedStandardMaterial(
                self,
                RedBitmapTexture(self, '../asset/grass.jpg')
            )
            tMat.shininess = 32
            while (i--) {
                var t = Math.random() * 10
                var tGeo = RedBox(self, t,t,t, 16, 16, 16)
                tMesh = RedMesh(self, tGeo, tMat2)
                tMesh.x = Math.random() * 200 - 100
                tMesh.y = Math.random() * 3
                tMesh.z = Math.random() * 200 - 100
                tMesh.rotationX = tMesh.rotationY = tMesh.rotationZ = Math.random() * 360
                tScene3D.addChild(tMesh)
            }

             RedOBJLoader(this, '../asset/obj/', 'female.obj', function (v) {
                console.log('호잇!', v)
               
                v['resultMesh'].scaleX = v['resultMesh'].scaleY = v['resultMesh'].scaleZ = 0.1
                tScene3D.addChild(v['resultMesh'])

            })

            tMesh = tScene3D.children[0]
            tMesh.material = tMat3
            tMesh.x = 0

            tMesh.z = 0
            tMesh.rotationX = tMesh.rotationY = tMesh.rotationZ = 0
            tMesh.scaleX = 100
            tMesh.scaleY = 0.1
            tMesh.scaleZ = 100


            // RedOBJLoader(this, '../asset/obj/', 'female.obj', function (v) {
            //     console.log('호잇!', v)
            //     v['resultMesh'].scaleX = v['resultMesh'].scaleY = v['resultMesh'].scaleZ = 0.05
            //     tScene3D.addChild( v['resultMesh'])

            // })

            tRenderer.renderDebuger.visible = true
            tRenderer.start(this, function (time) {
                i = tScene3D.children.length
                while (i--) {
                    if (i == 0) break
                    testMesh = tScene3D.children[i]
                    // testMesh.rotationX += 0.5
                    // testMesh.rotationY += 0.5
                    // testMesh.rotationZ += 0.5
                }
            })

            this['gui'] = new dat.GUI({
                name: 'test'
            });
        

            // var t0 = this['gui'].addFolder('fxaa')
            // var testFXAA = {
            //     bloom: true
            // }
            // t0.add(testFXAA, 'bloom', false, true).onChange(function (v) {
            //     if (!v) tScene3D['postEffectManager'].removeEffect(bloom)
            //     else tScene3D['postEffectManager'].addEffect(bloom)
            // }) 
            var t0 = this['gui'].addFolder('ssao')
            t0.add(ssao, 'blur', 0.0, 30)
            t0.add(ssao, 'range', 0.0, 100)
            t0.add(ssao, 'factor2', 0.0, 5)
            t0.add(ssao, 'contrast', -1, 1)

            var test = {
                mode: 'COLOR_SSAO'
            }
            t0.add(test, 'mode', ['ONLY_SSAO', 'ONLY_COLOR', 'COLOR_SSAO']).onChange(function (v) {
                ssao['mode'] = RedPostEffect_SSAO[v]
            })
            t0.open()







            console.log(tScene3D)
        })
    </script>
</body>

</html>