<html>

<head>
    <meta charset="UTF-8">
    <title>testAutoProgram</title>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, target-densitydpi=device-dpi"
    />
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
    <script src="../example/dat.gui.min.js"></script>
    <script src="../src/gl-matrix-min.js"></script>
    <script src="../src/RedGLUtil.js"></script>
    <script src="../src/detect/RedGLDetect.js"></script>
    <script src="../src/base/RedDefinePropertyInfo.js"></script>
    <script src="../src/RedGL.js"></script>

    <!--//-->

    <script src="../src/base/RedBaseObject3D.js"></script>
    <script src="../src/base/RedBaseContainer.js"></script>
    <script src="../src/base/RedBaseController.js"></script>
    <script src="../src/base/RedBaseLight.js"></script>
    <script src="../src/loader/RedImageLoader.js"></script>
    <script src="../src/base/RedBaseTexture.js"></script>
    <script src="../src/base/RedBaseMaterial.js"></script>


    <!--//-->
    <script src="../src/frameBuffer/RedFrameBuffer.js"></script>
    <!--//-->
    <script src="../src/geometry/RedBuffer.js"></script>
    <script src="../src/geometry/RedGeometry.js"></script>
    <script src="../src/geometry/RedInterleaveInfo.js"></script>
    <!--//-->

    <!--//-->
    <script src="../rnd/resources/RedAtlas.js"></script>
    <script src="../rnd/resources/system/RedAtlasUV.js"></script>
    <script src="../src/resources/system/RedTextureOptionChecker.js"></script>
    <script src="../src/resources/RedBitmapTexture.js"></script>
    <script src="../src/resources/RedDDSTexture.js"></script>
    <script src="../src/resources/RedVideoTexture.js"></script>
    <script src="../rnd/resources/RedAtlasTexture.js"></script>
    <script src="../src/resources/RedBitmapCubeTexture.js"></script>
    <!--재질-->

    <script src="../src/material/RedColorMaterial.js"></script>
    <script src="../src/material/RedColorPhongTextureMaterial.js"></script>
    <script src="../src/material/RedEnvironmentMaterial.js"></script>
    <script src="../src/material/RedBitmapMaterial.js"></script>
    <script src="../src/material/RedParticleColorMaterial.js"></script>
    <script src="../src/material/RedParticleBitmapMaterial.js"></script>
    <script src="../src/material/RedPointColorMaterial.js"></script>
    <script src="../src/material/RedPointBitmapMaterial.js"></script>
    <script src="../src/material/RedSheetMaterial.js"></script>
    <script src="../src/material/RedStandardMaterial.js"></script>
    <script src="../src/material/RedVideoMaterial.js"></script>

    <!--//-->
    <script src="../src/light/RedAmbientLight.js"></script>
    <script src="../src/light/RedDirectionalLight.js"></script>
    <script src="../src/light/RedPointLight.js"></script>
    <!--//-->
    <script src="../src/loader/JsonModelLoader.js"></script>
    <script src="../src/loader/obj/RedMTLLoader.js"></script>
    <script src="../src/loader/obj/RedOBJLoader.js"></script>
    <!--//-->
    <script src="../src/object3D/RedAxis.js"></script>
    <script src="../src/object3D/RedGrid.js"></script>
    <script src="../src/object3D/RedMesh.js"></script>
    <script src="../src/object3D/RedLine.js"></script>
    <script src="../src/object3D/RedSkyBox.js"></script>
    <script src="../src/object3D/RedSprite3D.js"></script>
    <!--//-->
    <script src="../src/particle/RedPointUnit.js"></script>
    <script src="../src/particle/RedParticleUnit.js"></script>
    <script src="../src/particle/RedParticleEmitter.js"></script>
    <!--//-->
    <script src="../src/primitives/RedBox.js"></script>
    <script src="../src/primitives/RedPlane.js"></script>
    <script src="../src/primitives/RedSphere.js"></script>
    <!--//-->
    <script src="../src/program/RedProgram.js"></script>
    <script src="../src/program/RedSystemShaderCode.js"></script>
    <script src="../src/program/RedShader.js"></script>
    <!--//-->
    <script src="../src/renderer/RedRenderer.js"></script>
    <script src="../src/renderer/system/RedRenderDebuger.js"></script>
    <script src="../src/renderer/system/RedSystemUniformUpdater.js"></script>


    <!--//-->
    <script src="../src/RedView.js"></script>
    <script src="../src/RedWorld.js"></script>
    <script src="../src/RedScene.js"></script>
    <!--//-->
    <script src="../src/camera/RedCamera.js"></script>
    <script src="../src/camera/RedBasicController.js"></script>
    <script src="../src/camera/RedObitController.js"></script>
    <!--시스템 재질-->
    <script src="../src/material/system/RedGridMaterial.js"></script>
    <script src="../src/material/system/RedDirectionalShadowMaterial.js"></script>
    <script src="../src/material/system/RedSkyBoxMaterial.js"></script>
    <script src="../src/material/system/RedPostEffectMaterial.js"></script>
    <!--쉐도우-->
    <script src="../src/shadow/RedDirectionalShadow.js"></script>
    <script src="../src/shadow/RedShadowManager.js"></script>
    <!--마우스이벤트-->
    <script src="../src/renderer/system/RedMouseEventManager.js"></script>
    <script src="../src/material/system/RedMouseEventMaterial.js"></script><!--이펙트-->
    <script src="../src/postEffect/RedPostEffectManager.js"></script>
    <script src="../src/base/RedBasePostEffect.js"></script>
    <script src="../src/postEffect/bloom/RedPostEffect_Bloom.js"></script>
    <script src="../src/postEffect/bloom/RedPostEffect_BloomThreshold.js"></script>
    <script src="../src/postEffect/blur/RedPostEffect_Blur.js"></script>
    <script src="../src/postEffect/blur/RedPostEffect_BlurX.js"></script>
    <script src="../src/postEffect/blur/RedPostEffect_BlurY.js"></script>
    <script src="../src/postEffect/blur/RedPostEffect_GaussianBlur.js"></script>
    <script src="../src/postEffect/blur/RedPostEffect_ZoomBlur.js"></script>
    <script src="../src/postEffect/adjustments/RedPostEffect_BrightnessContrast.js"></script>
    <script src="../src/postEffect/adjustments/RedPostEffect_Threshold.js"></script>
    <script src="../src/postEffect/adjustments/RedPostEffect_Invert.js"></script>
    <script src="../src/postEffect/adjustments/RedPostEffect_Gray.js"></script>
    <script src="../src/postEffect/adjustments/RedPostEffect_HueSaturation.js"></script>
    <script src="../src/postEffect/pixelate/RedPostEffect_HalfTone.js"></script>
    <script src="../src/postEffect/pixelate/RedPostEffect_Pixelize.js"></script>
    <script src="../src/postEffect/RedPostEffect_Convolution.js"></script>
    <script src="../src/postEffect/dof/RedPostEffect_DoF.js"></script>
    <script src="../src/postEffect/dof/RedPostEffect_DoF_DepthMaterial.js"></script>
    <script src="../src/postEffect/RedPostEffect_Film.js"></script>
    <script src="../src/postEffect/RedPostEffect_Vignetting.js"></script>
    <script src="../src/postEffect/antialiasing/RedPostEffect_FXAA.js"></script>
</head>

<body>
<canvas id="test" style="border: none;background:red"></canvas>
<div id='program' style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:20px;color:#fff">
    testest
</div>
<script>
    var t = document.getElementById('test')
    document.body.appendChild(t)
    RedGL(t, function (v) {
        var tGL;
        var tWorld, tScene3D, tCamera
        var tRenderer;
        var self;
        self = this
        tGL = this.gl;
        this.world = tWorld = RedWorld();
        tScene3D = RedScene(this);
        tCamera = RedObitController(this)
        var testDLight, testALight;
        testDLight = RedDirectionalLight(this, '#fff')
        testALight = RedAmbientLight(this, '#111', 1)
        tScene3D.addLight(testALight)
        tScene3D.addLight(testDLight)
        var testPLight = RedPointLight(this, '#ff0000')
        testPLight.x = -3
        testPLight.y = -3
        testPLight.z = -3
        testPLight['radius'] = 4
        testPLight['intensity'] = 1
        testPLight.debug = true
        tScene3D.addLight(testPLight)
        var testPLight2 = RedPointLight(this, '#00ff00')
        testPLight2.x = -3
        testPLight2.y = -3
        testPLight2.z = -3
        testPLight2['radius'] = 10
        testPLight2['intensity'] = 1
        testPLight2.debug = true
        tScene3D.addLight(testPLight2)
        tRenderer = RedRenderer();
        tWorld.addView(RedView('test', this, tScene3D, tCamera));
        RedView('test').setSize('100%', '100%')
        RedView('test').setLocation('0%', '0%')
        var testMaterial
        var testTextureMap = {
            diffuseTexture: RedBitmapTexture(this, '../asset/crate.png'),
            normalTexture: RedBitmapTexture(this, '../asset/normalTest.jpg'),
            specularTexture: RedBitmapTexture(this, '../asset/specular.png'),
            displacementTexture: RedBitmapTexture(this, '../asset/displacementTest.jpg')
        }
        testMaterial = RedEnvironmentMaterial(
            this,
            null,
            RedBitmapCubeTexture(this, [
                '../asset/cubemap/SwedishRoyalCastle/px.jpg',
                '../asset/cubemap/SwedishRoyalCastle/nx.jpg',
                '../asset/cubemap/SwedishRoyalCastle/py.jpg',
                '../asset/cubemap/SwedishRoyalCastle/ny.jpg',
                '../asset/cubemap/SwedishRoyalCastle/pz.jpg',
                '../asset/cubemap/SwedishRoyalCastle/nz.jpg'
            ])
        )
        tScene3D.skyBox =
            RedSkyBox(this, [
                '../asset/cubemap/SwedishRoyalCastle/px.jpg',
                '../asset/cubemap/SwedishRoyalCastle/nx.jpg',
                '../asset/cubemap/SwedishRoyalCastle/py.jpg',
                '../asset/cubemap/SwedishRoyalCastle/ny.jpg',
                '../asset/cubemap/SwedishRoyalCastle/pz.jpg',
                '../asset/cubemap/SwedishRoyalCastle/nz.jpg'
            ]);
        JsonModelLoader(this, 'testJsonModel', '../asset/teapot.json', function (interleaveBuffer, indexBuffer) {
            console.log('호잇!', interleaveBuffer, indexBuffer)
            var i = 8500 / 2
            while (i--) {
                var testMesh = RedMesh(self, RedGeometry(interleaveBuffer, indexBuffer), testMaterial)
                testMesh.x = Math.random() * 250 - 125
                testMesh.y = Math.random() * 250 - 125
                testMesh.z = Math.random() * 250 - 125
                testMesh.scaleX = testMesh.scaleY = testMesh.scaleZ = 0.3
                testMesh.rotationX = Math.random() * 360
                testMesh.rotationY = Math.random() * 360
                testMesh.rotationZ = Math.random() * 360
                tScene3D.addChild(testMesh)
                var testMesh = RedMesh(self, RedBox(self), testMaterial)
                testMesh.x = Math.random() * 250 - 125
                testMesh.y = Math.random() * 250 - 125
                testMesh.z = Math.random() * 250 - 125
                testMesh.scaleX = testMesh.scaleY = testMesh.scaleZ = 2.5
                testMesh.rotationX = Math.random() * 360
                testMesh.rotationY = Math.random() * 360
                testMesh.rotationZ = Math.random() * 360
                tScene3D.addChild(testMesh)
            }
//			tScene3D.sortGeometry()
        })
        tRenderer.renderDebuger.visible = true
        var tProgramDom = document.querySelector('#program')
        tRenderer.start(this, function (time) {
            // testInterleaveBuffer.upload(interleaveData)
            var i = tScene3D.children.length
            while (i--) {
                if (i == 0) break
                testMesh = tScene3D.children[i]
                testMesh.rotationX += 0.3
                testMesh.rotationY += 0.3
                testMesh.rotationZ += 0.3
            }
            tProgramDom.innerHTML = '현재프로그램 : ' + (tScene3D['useFog'] ? testMaterial['_programList']['fog'][testMaterial['program']['key']]['key'] : testMaterial['program']['key'])
            testDLight.x = Math.sin(time / 1500) * 10
            testDLight.y = Math.cos(time / 1500) * 10
            testDLight.z = Math.cos(time / 1500) * 10
            testMaterial['displacementPower'] = Math.sin(time / 100)
            // tCamera.z = 20
            // tCamera.lookAt(0, 0, 0)
            testPLight.x = -Math.sin(time / 1500) * 5
            testPLight.y = 2
            testPLight.z = -Math.cos(time / 1500) * 5
            testPLight2.x = Math.sin(time / 1500) * 18.5
            testPLight2.y = 0
            testPLight2.z = Math.cos(time / 1500) * 18.5
        })
        this['gui'] = new dat.GUI({
            name: 'test'
        });
        var testData = {
            state: testMaterial.program.key,
            sprite3DYn: false,
            addSphere500: function () {
                var i = 500
                while (i--) {
                    var testMesh = RedMesh(self, RedSphere(self, 5, 16, 16, 16), testMaterial)
                    testMesh.x = Math.random() * 250 - 125
                    testMesh.y = Math.random() * 250 - 125
                    testMesh.z = Math.random() * 250 - 125
                    testMesh.scaleX = testMesh.scaleY = testMesh.scaleZ = 0.3
                    testMesh.rotationX = Math.random() * 360
                    testMesh.rotationY = Math.random() * 360
                    testMesh.rotationZ = Math.random() * 360
                    tScene3D.addChild(testMesh)
                }
            },
            sortGeometry: function () {
                tScene3D.sortGeometry()
            }
        }
        var t0 = this['gui'].addFolder('autoProgramTest')
        t0.autoPlace = false
        var tList = []
        for (var k in testMaterial._programList['basic']) {
            if (k.indexOf('fog') > -1 || k.indexOf('sprite3D') > -1) continue
            tList.push(testMaterial._programList['basic'][k]['key'].replace('environmentProgram_', ''))
        }
        t0.add(tScene3D, 'useFog', true, false)
        t0.add(testData, 'state', tList).onChange(function (v) {
            v = v.split('_')
            testMaterial.diffuseTexture = null
            testMaterial.normalTexture = null
            testMaterial.displacementTexture = null
            testMaterial.specularTexture = null
            v.forEach(function (k) {
                testMaterial[k] = testTextureMap[k]
            })
            console.log(v)
        })
        t0.add(testData, 'addSphere500')
        t0.add(tScene3D, 'sortGeometry')
        t0.open()
        console.log(tScene3D)
    })
</script>
</body>

</html>