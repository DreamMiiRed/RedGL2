<html>

<head>
    <meta charset="UTF-8">
    <title>postEffect</title>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, target-densitydpi=device-dpi"
    />
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
    <script src="dat.gui.min.js"></script>
    <script src="baseTestUI.js"></script>
    <script src="../release/RedGL.min.js"></script>
</head>

<body>
<canvas id="test" style="border: none;background:red"></canvas>
<script>
	var testUI;
	document.getElementById('test')
	RedGL(document.getElementById('test'), function (v) {
		if ( v ) {
			console.log('초기화 성공!')
			var tWorld, tScene, tController, tRenderer;
			var self;
			self = this;
			// 월드 생성
			this['world'] = tWorld = RedWorld();
			// 씬 생성
			tScene = RedScene(this);
			// 카메라 생성
			tController = RedObitController(this);
			tController.distance = 20
			tController.tilt = -30
			tController.pan = 45
			// 렌더러 생성
			tRenderer = RedRenderer();
			// 뷰생성 및 적용
			tWorld.addView(RedView('test', this, tScene, tController));
			tWorld.addView(RedView('test2', this, tScene, tController));
			RedView('test').setSize('50%', '100%')
			RedView('test').setLocation('0%', '0%')
			RedView('test2').setSize('50%', '100%')
			RedView('test2').setLocation('50%', '0%')
			// 그리드 설정
			// tScene['grid'] = RedGrid(this)
			// 라이트 설정
			var testDLight, testALight, testPLight;
			testDLight = RedDirectionalLight(this, '#fff', 1)
			testDLight.x = 3
			testDLight.y = 2
			testDLight.z = 3
			testDLight.debug = true
			tScene.addLight(testDLight)
			testDLight = RedDirectionalLight(this, '#ff0000', 1)
			testDLight.x = -3
			testDLight.y = 2
			testDLight.z = -3
			testDLight.debug = true
			tScene.addLight(testDLight)
			testPLight = RedPointLight(this, '#00ff00', 0.5)
			testPLight.x = -3
			testPLight.y = -3
			testPLight.z = -3
			testPLight['radius'] = 2
			testPLight['intensity'] = 1
			testPLight.debug = true
			tScene.addLight(testPLight)
			tScene.skyBox =
				RedSkyBox(this, [
					'../asset/cubemap/posx.png',
					'../asset/cubemap/negx.png',
					'../asset/cubemap/posy.png',
					'../asset/cubemap/negy.png',
					'../asset/cubemap/posz.png',
					'../asset/cubemap/negz.png'
				]);
			// OBJ 로딩
			RedOBJLoader(this, '../asset/obj/', 'female.obj', function (v) {
				v['resultMesh'].scaleX = v['resultMesh'].scaleY = v['resultMesh'].scaleZ = 0.025
				tScene.addChild(v['resultMesh'])
				var i = 10
				var max = 10
				var j
				var tMesh;
				var tGeo = RedBox(self)
				var tMat = RedColorPhongMaterial(self)
				while ( i-- ) {
					j = 10
					while ( j-- ) {
						tMesh = RedMesh(self, tGeo, tMat)
						tMesh.x = Math.sin(Math.PI * 2 / (max - 1) * i) * j * 2
						tMesh.z = Math.cos(Math.PI * 2 / (max - 1) * i) * j * 2
						tScene.addChild(tMesh)
					}
				}
			})
			// 렌더시작
			tRenderer.start(this, function (time) {
				testDLight.x = Math.sin(time / 1000) * 2
				testDLight.y = Math.cos(time / 1000) * 2
				testDLight.z = Math.cos(time / 1000) * 2
				testPLight.x = Math.sin(time / 1500) * 1
				testPLight.y = Math.cos(time / 1500) * 1 + 1
				testPLight.z = Math.cos(time / 1500) * 1
			})
			// 렌더 디버거 활성화
			tRenderer['renderDebuger']['visible'] = true
			//
			var effectList;
			effectList = {
				RedPostEffect_Invert: RedPostEffect_Invert(this),
				RedPostEffect_Blur: RedPostEffect_Blur(this),
				RedPostEffect_BlurX: RedPostEffect_BlurX(this),
				RedPostEffect_BlurY: RedPostEffect_BlurY(this),
				RedPostEffect_Gray: RedPostEffect_Gray(this),
				RedPostEffect_Pixelize: RedPostEffect_Pixelize(this),
				RedPostEffect_Convolution: RedPostEffect_Convolution(this, RedPostEffect_Convolution['EMBOSS']),
				RedPostEffect_HueSaturation: RedPostEffect_HueSaturation(this),
				RedPostEffect_Vignetting: RedPostEffect_Vignetting(this),
				RedPostEffect_BrightnessContrast: RedPostEffect_BrightnessContrast(this),
				RedPostEffect_ZoomBlur: RedPostEffect_ZoomBlur(this),
				RedPostEffect_HalfTone: RedPostEffect_HalfTone(this),
				RedPostEffect_Bloom: RedPostEffect_Bloom(this)
			}
			testUI(this, tScene, effectList)
		} else {
			console.log('초기화 실패!')
		}
	})
	testUI = function (redGL, tScene, effectList) {
		console.log('test')
		var gui = new baseTestUI(redGL)
		gui.initRedGL()
		var t0 = gui['gui'].addFolder('effectList')
		var test = function () {
			for ( var k in effectList ) {
				this[k] = false
			}
		}
		test = new test()
		for ( var k in test ) {
			t0.add(test, k).name(k.replace('RedPostEffect_', '')).onChange((function () {
				var tEffect = effectList[k]
				return function (v) {
					if ( v ) RedView('test')['postEffectManager'].addEffect(tEffect)
					else RedView('test')['postEffectManager'].removeEffect(tEffect)
				}
			})())
		}
		t0.open()
	}
</script>
</body>

</html>