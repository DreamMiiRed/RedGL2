<html>

<head>
    <meta charset="UTF-8">
    <title>RedText</title>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, target-densitydpi=device-dpi"
    />
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>

    <script src="dat.gui.min.js"></script>
    <script src="baseTestUI.js"></script>
    <script src="../release/RedGL.min.js"></script>
</head>

<body>
<script id='testSource'>
	var testUI;
	var canvas;
	var assetPath = '../../asset/'
	canvas = document.createElement('canvas');
	document.body.appendChild(canvas);
	RedGL(canvas, function (v) {
		if ( v ) {
			console.log('초기화 성공!')
			var tWorld, tScene, tController, tRenderer;
			var self;
			self = this;
			// 월드 생성
			this['world'] = tWorld = RedWorld();
			// 씬 생성
			tScene = RedScene(this);
			// 카메라 생성
			tController = RedObitController(this);
			tController.tilt = -30
			tController.distance = 1
			tController.speedDistance = 0.1
			tController.pan = 0
			// 렌더러 생성
			tRenderer = RedRenderer();
			// 뷰생성 및 적용
			tWorld.addView(RedView('test', this, tScene, tController));
			// 라이트 설정
			var testDLight;
			testDLight = RedDirectionalLight(this, '#fff', 1)
			testDLight.x = 3
			testDLight.y = 2
			testDLight.z = 3
			tScene.addLight(testDLight)
			tScene.skyBox =
				RedSkyBox(this, [
					'../asset/cubemap/SwedishRoyalCastle/px.jpg',
					'../asset/cubemap/SwedishRoyalCastle/nx.jpg',
					'../asset/cubemap/SwedishRoyalCastle/py.jpg',
					'../asset/cubemap/SwedishRoyalCastle/ny.jpg',
					'../asset/cubemap/SwedishRoyalCastle/pz.jpg',
					'../asset/cubemap/SwedishRoyalCastle/nz.jpg'
				]);
			var testRedText = RedText(self)
			var str = ('<div >Here is a <strong>paragraph</strong> that requires <em>word wrap</em>' +
			'<br>br태그는 빈 div로 치환함<br>' +
			'hr태그는 안됨' +
			'<pre>pre test      test pre</pre>' +
			'<h1 style="color:#2233aa">My First Heading</h1>' +
			'<h2 style="color:red">Heading 2</h2><h3 style="color:#fff">Heading 3</h3><h4>Heading 4</h4><h5>Heading 5</h5><h6>Heading 6</h6>' +
			'<p>My first paragraph.</p>' +
			'<ul><li>Coffee</li><li>Tea</li><li>Milk</li></ul>' +
			'<button>this is Button</button><br>' +
			Math.random())
			testRedText.text = str
			testRedText.background = 'rgba(255,0,0,0.1)'
			testRedText.width = 360
			testRedText.height = 1024
			testRedText.scaleX = testRedText.scaleY = testRedText.scaleZ = 1
			tScene.addChild(testRedText)
			// 렌더시작
			tRenderer.start(this, function (time) {})
			// 렌더 디버거 활성화
			tRenderer['renderDebuger']['visible'] = true
			testUI(this, tScene, testRedText)
			// 이펙트 적용
		} else {
			console.log('초기화 실패!')
		}
	})
	testUI = function (redGL, tScene, testRedText) {
		this['gui'] = new dat.GUI({
			name: 'RedText'
		});
		var t0 = this['gui'].addFolder('RedText')
		var testData = {
			background: testRedText.background,
			color: testRedText.color,
			sprite3DMode: false,
			perspectiveScale: false
		}
		t0.add(testRedText, 'width', 2, 512, 1)
		t0.add(testRedText, 'height', 2, 2048, 1);
		t0.add(testRedText, 'padding', 0, 100, 0.1)
		t0.add(testRedText, 'fontFamily', ['Arial', 'Times New Roman', 'Times', 'serif']);
		t0.add(testRedText, 'fontSize', 0, 100, 0.1)
		t0.add(testRedText, 'fontWeight', ['normal', 'bold']);
		t0.add(testRedText, 'fontStyle', ['normal', 'italic']);
		t0.add(testRedText, 'lineHeight', 0, 100, 0.1)
		t0.add(testRedText, 'letterSpacing', 0, 4, 0.01)
		t0.add(testRedText, 'wordBreak', ['normal', 'break-all', 'break-word', 'keep-all', 'unset'])
		t0.add(testRedText, 'verticalAlign', ['top', 'middle', 'bottom']);
		t0.add(testRedText, 'textAlign', ['left', 'center', 'right']);
		t0.add(testData, 'sprite3DMode').onChange(function (v) {
			tScene.children.forEach(function (redText) {
				if ( redText instanceof RedText ) redText.sprite3DYn = v
			})
		});
		t0.add(testData, 'perspectiveScale').onChange(function (v) {
			tScene.children.forEach(function (redText) {
				if ( redText instanceof RedText ) redText.perspectiveScale = v
			})
		});
		['color'].forEach(function (k) {
			t0.addColor(testData, k).onChange(function (v) {
				testRedText[k] = v
			})
		});
		t0.open()
		var t0, t1;
		t0 = document.createElement('div')
		t0.style.position = 'absolute'
		t0.style.bottom = '10px'
		t0.style.right = '10px'
		document.body.appendChild(t0)
		t1 = document.createElement('div')
		t1.style.position = 'absolute'
		t1.style.width = '500px'
		t1.style.bottom = '225px'
		t1.style.right = '10px'
		t1.style.fontWeight = 'bold'
		t1.innerHTML = 'TextContent or HTML'
		t1.style.textShadow = '1px 1px 0px rgba(255,255,255,0.4)'
		t0.appendChild(t1)
		t1 = document.createElement('div')
		t1.setAttribute('contenteditable', true)
		t1.textContent = testRedText.text
		t1.style.position = 'absolute'
		t1.style.bottom = '0px'
		t1.style.right = '0px'
		t1.style.width = '500px'
		t1.style.height = '200px'
		t1.style.padding = '10px'
		t1.style.fontSize = '12px'
		t1.style.background = 'rgba(255,255,255,0.5)'
		t0.appendChild(t1)
		t1.addEventListener('input', function () {
			console.log('testset')
			testRedText['text'] = this.textContent
		})
	}
</script>
</body>

</html>